@page "/"

@rendermode InteractiveServer

@using Infrastructure.Models
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserManager<ApplicationUser> UserManager

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<AuthorizeView>
    <Authorized>
        @code {
            private string? userName;
            private string? userRole;

            protected override async Task OnInitializedAsync()
            {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var user = authState.User;

            userName = user.Identity?.IsAuthenticated == true ? user.Identity.Name : null;

            if (user.Identity?.IsAuthenticated == true)
            {
                var appUser = await UserManager.GetUserAsync(user);
                if (appUser != null)
                {
                    var roles = await UserManager.GetRolesAsync(appUser);
                    userRole = roles.FirstOrDefault() ?? "No roles";
                }
                else
                {
                    userRole = "Unknown";
                }
            }
            else
            {
                userRole = null;
            }
            }
        }
        <p>Hello, @userName!</p>
        <p>Role: @userRole</p>
    </Authorized>
    <NotAuthorized>
        <p>You are not logged in.</p>
    </NotAuthorized>
</AuthorizeView>
